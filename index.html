<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Symbiotic Snake Xenzia</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: black;
        margin: 0;
        font-family: system-ui, sans-serif;
        color: #bfff00;
        text-align: center;
      }
      #gameCanvas {
        background: #111;
        display: none;
        margin: 0 auto;
        border: 2px solid #bfff00;
        touch-action: none;
      }
      #intro,
      #gameOver {
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #hud {
        display: none;
        margin: 8px;
      }
      #fact {
        margin-top: 20px;
        font-size: 1.1em;
        color: #bfff00;
        white-space: pre-wrap;
        min-height: 3em;
      }
      /* Mobile arrow controls */
      #controls {
        display: none;
        margin: 15px auto;
      }
      .arrow-btn {
        background: #bfff00;
        border: none;
        color: black;
        font-size: 24px;
        width: 60px;
        height: 60px;
        border-radius: 10px;
        margin: 5px;
      }
      @media (max-width: 768px) {
        #controls {
          display: flex;
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Intro screen -->
    <div id="intro">
      <h1>Symbiotic Snake Xenzia</h1>
      <input
        id="playerName"
        class="form-control w-50 mb-3"
        placeholder="Enter your name"
      />
      <button id="startBtn" class="btn btn-success">Start Game</button>
    </div>

    <!-- HUD -->
    <div id="hud">
      <span id="hudName"></span> | Score: <span id="score">0</span>
    </div>

    <!-- Game canvas -->
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <!-- Mobile controls -->
    <div id="controls">
      <div>
        <button class="arrow-btn" onclick="setDirection('up')">↑</button>
      </div>
      <div>
        <button class="arrow-btn" onclick="setDirection('left')">←</button>
        <button class="arrow-btn" onclick="setDirection('down')">↓</button>
        <button class="arrow-btn" onclick="setDirection('right')">→</button>
      </div>
    </div>

    <!-- Game over -->
    <div id="gameOver" style="display: none">
      <h2 id="finalMsg"></h2>
      <p id="fact"></p>
      <button class="btn btn-success" onclick="restart()">Play Again</button>
    </div>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const scoreEl = document.getElementById("score");
      const hud = document.getElementById("hud");
      const intro = document.getElementById("intro");
      const gameOver = document.getElementById("gameOver");
      const finalMsg = document.getElementById("finalMsg");
      const factEl = document.getElementById("fact");
      const playerNameInput = document.getElementById("playerName");
      const hudName = document.getElementById("hudName");
      const controls = document.getElementById("controls");

      let snake, apple, dx, dy, score, gameInterval, gameActive, playerName;
      let swipeStartX, swipeStartY, swipeEndX, swipeEndY;

      const box = 20; // grid size

      const symbioticInsights = [
        "Liquidity isn’t locked. It’s liberated. Welcome to Symbiotic.",
        "Symbiotic turns staking into a universal language of security.",
        "In DeFi, silos are fragile. Symbiotic builds bridges of trust.",
        "Symbiotic is where AI transparency meets decentralized finance.",
        "Shared, sovereign, and unstoppable. That’s the Symbiotic future.",
        "Your stake doesn’t just sit — it collaborates in Symbiotic.",
        "Symbiotic is modular armor for decentralized networks.",
        "The next frontier of crypto isn’t coordination. It’s Symbiotic.",
        "From Seoul to Singapore, Symbiotic is rewriting staking culture.",
        "Symbiotic is the heartbeat of trust-minimized collaboration.",
      ];

      function initGame() {
        // start with a longer snake (length 5)
        snake = [];
        for (let i = 0; i < 5; i++) {
          snake.push({ x: (9 - i) * box, y: 10 * box });
        }
        dx = box;
        dy = 0;
        score = 0;
        scoreEl.textContent = score;
        placeApple();
        gameActive = true;
      }

      function placeApple() {
        apple = {
          x: Math.floor(Math.random() * (canvas.width / box)) * box,
          y: Math.floor(Math.random() * (canvas.height / box)) * box,
        };
      }

      function draw() {
        ctx.fillStyle = "#111";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // draw snake
        snake.forEach((part, i) => {
          ctx.fillStyle = i === 0 ? "#bfff00" : "#66aa00";
          ctx.fillRect(part.x, part.y, box, box);
        });

        // draw apple
        ctx.fillStyle = "#bfff00";
        ctx.beginPath();
        ctx.arc(apple.x + box / 2, apple.y + box / 2, box / 2, 0, 2 * Math.PI);
        ctx.fill();

        // move snake
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        // collision with walls
        if (
          head.x < 0 ||
          head.y < 0 ||
          head.x >= canvas.width ||
          head.y >= canvas.height
        ) {
          endGame();
          return;
        }
        // collision with self
        for (let i = 0; i < snake.length; i++) {
          if (snake[i].x === head.x && snake[i].y === head.y) {
            endGame();
            return;
          }
        }

        // eat apple
        if (head.x === apple.x && head.y === apple.y) {
          score++;
          scoreEl.textContent = score;
          snake.unshift(head);
          placeApple();
        } else {
          snake.pop();
          snake.unshift(head);
        }
      }

      function startGame() {
        playerName = playerNameInput.value.trim() || "Player";
        hudName.textContent = playerName;

        intro.style.display = "none";
        gameOver.style.display = "none";
        hud.style.display = "block";
        canvas.style.display = "block";
        controls.style.display = "flex"; // show arrows only during gameplay

        initGame();

        // game loop
        gameInterval = setInterval(draw, 100);
      }

      function endGame() {
        gameActive = false;
        clearInterval(gameInterval);
        canvas.style.display = "none";
        hud.style.display = "none";
        controls.style.display = "none"; // hide arrows after game ends
        gameOver.style.display = "flex";

        const insight =
          symbioticInsights[
            Math.floor(Math.random() * symbioticInsights.length)
          ];
        finalMsg.textContent = `${playerName}, you scored ${score} points in the Symbiotic Snake Game!`;
        typeWriter(insight);
      }

      function typeWriter(text) {
        factEl.textContent = "";
        let i = 0;
        function typing() {
          if (i < text.length) {
            factEl.textContent += text.charAt(i);
            i++;
            setTimeout(typing, 40); // speed of typing
          }
        }
        typing();
      }

      function restart() {
        intro.style.display = "flex";
        gameOver.style.display = "none";
        hud.style.display = "none";
        canvas.style.display = "none";
        controls.style.display = "none"; // hide arrows until next game starts
      }

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        if (!gameActive) return;
        if (e.key === "ArrowLeft" && dx === 0) {
          dx = -box;
          dy = 0;
        } else if (e.key === "ArrowUp" && dy === 0) {
          dx = 0;
          dy = -box;
        } else if (e.key === "ArrowRight" && dx === 0) {
          dx = box;
          dy = 0;
        } else if (e.key === "ArrowDown" && dy === 0) {
          dx = 0;
          dy = box;
        }
      });

      // Touch swipe controls
      canvas.addEventListener("touchstart", (e) => {
        const t = e.touches[0];
        swipeStartX = t.clientX;
        swipeStartY = t.clientY;
      });

      canvas.addEventListener("touchend", (e) => {
        const t = e.changedTouches[0];
        swipeEndX = t.clientX;
        swipeEndY = t.clientY;

        let dxSwipe = swipeEndX - swipeStartX;
        let dySwipe = swipeEndY - swipeStartY;

        if (Math.abs(dxSwipe) > Math.abs(dySwipe)) {
          if (dxSwipe > 0 && dx === 0) {
            dx = box;
            dy = 0;
          } // right
          else if (dxSwipe < 0 && dx === 0) {
            dx = -box;
            dy = 0;
          } // left
        } else {
          if (dySwipe > 0 && dy === 0) {
            dx = 0;
            dy = box;
          } // down
          else if (dySwipe < 0 && dy === 0) {
            dx = 0;
            dy = -box;
          } // up
        }
      });

      // Arrow button controls
      function setDirection(dir) {
        if (!gameActive) return;
        if (dir === "left" && dx === 0) {
          dx = -box;
          dy = 0;
        } else if (dir === "up" && dy === 0) {
          dx = 0;
          dy = -box;
        } else if (dir === "right" && dx === 0) {
          dx = box;
          dy = 0;
        } else if (dir === "down" && dy === 0) {
          dx = 0;
          dy = box;
        }
      }

      document.getElementById("startBtn").addEventListener("click", startGame);
    </script>
  </body>
</html>
